async function getApiKey() {
  let e = await fetch("https://secure-api-production.up.railway.app/get-key", {
    headers: { Authorization: "Bearer CGLsuriatIwpf3w" },
  });
  if (!e.ok) return null;
  let t = await e.json();
  return t.apiKey;
}
window.addEventListener("scroll", function () {
  let e = document.querySelector(".header");
  window.scrollY > 50
    ? e.classList.add("scrolled")
    : e.classList.remove("scrolled");
}),
  document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("phone").addEventListener("input", function (e) {
      let t = e.target.value.replace(/\D/g, "");
      (t =
        t.length <= 10
          ? t.replace(/(\d{2})(\d{4})(\d{0,4})/, "($1) $2-$3")
          : t.replace(/(\d{2})(\d{5})(\d{0,4})/, "($1) $2-$3")),
        (e.target.value = t);
    });
  }),
  getApiKey().then((e) => {
    document
      .getElementById("contactForm")
      .addEventListener("submit", function (t) {
        t.preventDefault(),
          emailjs.init(e),
          emailjs
            .send("service_i640gka", "template_puaoag7", {
              name: document.getElementById("name").value,
              email: document.getElementById("email").value,
              phone: document.getElementById("phone").value,
              search: document.getElementById("search").value,
              confirm: document.getElementById("confirm").checked
                ? "Sim"
                : "N\xe3o",
            })
            .then(
              function (e) {
                document.getElementById("contactForm").reset(),
                  alert("E-mail enviado com sucesso!");
              },
              function (e) {
                alert("Erro ao enviar e-mail. Tente novamente mais tarde.");
              }
            );
      });
  }),
  document.querySelectorAll("nav a").forEach((e) => {
    e.addEventListener("click", function (e) {
      e.preventDefault();
      let t = this.getAttribute("href").substring(1),
        n = document.getElementById(t);
      n && n.scrollIntoView({ behavior: "smooth", block: "start" });
    });
  }),
  window.addEventListener("load", function () {
    let e = document.createElement("div");
    (e.id = "whatsapp-tooltip"),
      (e.className = "whatsapp-tooltip"),
      (e.innerText = "Fale conosco no WhatsApp!"),
      (e.style.opacity = "0"),
      document.body.appendChild(e);
    let t = document.createElement("div");
    (t.id = "whatsapp-button"), (t.className = "whatsapp-button");
    let n = document.createElement("a");
    (n.href = "https://w.app/reidocodigo"),
      (n.target = "_blank"),
      (n.rel = "noopener noreferrer");
    let a = document.createElement("img");
    (a.src = "/assets/images/whatsapp.webp"),
      (a.alt = "Entre em contato conosco"),
      (a.style.width = "80px"),
      (a.style.height = "80px"),
      n.appendChild(a),
      t.appendChild(n),
      document.body.appendChild(t),
      t.addEventListener("mouseenter", function () {
        (e.style.opacity = "1"), (e.style.transform = "translateY(0)");
      }),
      t.addEventListener("mouseleave", function () {
        (e.style.opacity = "0"), (e.style.transform = "translateY(10px)");
      });
    let l = document.getElementById("whatsapp-button"),
      o;
    function r() {
      (e.style.opacity = "1"), (e.style.transform = "translateY(0)");
    }
    function s() {
      (e.style.opacity = "0"), (e.style.transform = "translateY(10px)");
    }
    setTimeout(r, 1e3),
      (o = setTimeout(s, 3e4)),
      l.addEventListener("mouseover", () => {
        clearTimeout(o), r();
      }),
      l.addEventListener("mouseleave", () => {
        o = setTimeout(s, 500);
      }),
      l.addEventListener("click", () => {
        s();
      });
    const bgElement = document.querySelector(".background");
    if (bgElement) {
      let e = new Image();
      (e.src = "/assets/images/programador.webp"),
        (e.onload = function () {
          bgElement.style.backgroundImage = `
        linear-gradient(to bottom, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0)),
        url('${e.src}')
      `;
        });
    }
  });
